---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import ArtworkWithCampDataLayout from "../../../layouts/ArtworkWithCampDataLayout.astro";
import RelatedArtworks from "../../../components/RelatedArtworks.astro";

export async function getStaticPaths() {
  const artworkEntries = await getCollection("artwork");
  return artworkEntries.map((entry: CollectionEntry<"artwork">) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry }: { entry: CollectionEntry<"artwork"> } = Astro.props;
const { Content } = await entry.render();

// Fetch related artworks from same series (excluding current)
const allArtworks = await getCollection("artwork");
const relatedWorks = allArtworks
  .filter((art) =>
    art.data.series === entry.data.series &&
    art.slug !== entry.slug
  )
  .slice(0, 6);
---

<ArtworkWithCampDataLayout entry={entry}>
  <Content />

  <!-- Related Artworks Component -->
  {relatedWorks.length > 0 && (
    <RelatedArtworks
      artworks={relatedWorks}
      seriesName={entry.data.series}
      seriesPath={`/artwork/japanese-american-internment-camps`}
      maxItems={6}
    />
  )}
</ArtworkWithCampDataLayout>