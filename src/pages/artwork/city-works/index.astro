---
import { getCollection } from 'astro:content';
import ArtworkCard from '@components/ArtworkCard.astro';
import GalleryScrollLayout from '@layouts/GalleryScrollLayout.astro';
import GalleryNavigation from '@components/GalleryNavigation.astro';
import GalleryKeyboardHints from '@components/GalleryKeyboardHints.astro';
import type { CollectionEntry } from 'astro:content';
import type { ArtworkEntry } from '../../../types/artwork';
import { generateSEOTags, type SEOConfig } from "@utils/seo";

const CURRENT_SERIES_SLUG = 'city-works';
const CURRENT_SERIES_NAME = 'City Works';

const allEntries: CollectionEntry<'artwork'>[] = await getCollection("artwork");
const artworks: ArtworkEntry[] = allEntries.filter(
  (entry) => entry.data.series === CURRENT_SERIES_NAME
);

const seoConfig: SEOConfig = {
  title: "City Works - Urban Architecture and Public Spaces",
  description: "Panoramic photo collages documenting urban architecture, public spaces, and civic infrastructure.",
  keywords: ["urban architecture", "public spaces", "city infrastructure", "urban landscape", "civic architecture", "city documentation"],
  type: "article" as const,
  image: artworks[0]?.data.cloudinaryId
};

const seoTags = generateSEOTags(seoConfig);
---

<GalleryScrollLayout
  title="City Works"
  description="Panoramic photo collages of urban architecture and public spaces"
  artworkCount={artworks.length}
  seoTags={seoTags}
>
  <GalleryKeyboardHints />

  {artworks.map((artwork, index) => (
    <ArtworkCard
      artwork={artwork}
      index={index}
      total={artworks.length}
      seriesName={CURRENT_SERIES_NAME}
      isFirst={index === 0}
    />
  ))}
  <!-- Gallery Navigation - Next/Previous Series -->
  <GalleryNavigation currentSeries="City Works" />
</GalleryScrollLayout>

<script>
  // Infinite scroll: Load next series when approaching bottom
  import { initInfiniteScroll } from '../../../scripts/gallery-infinite-scroll';

  initInfiniteScroll('city-works');
</script>
