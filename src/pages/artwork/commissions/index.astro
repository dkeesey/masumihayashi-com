---
import { getCollection } from 'astro:content';
import ArtworkCard from '@components/ArtworkCard.astro';
import GalleryScrollLayout from '@layouts/GalleryScrollLayout.astro';
import GalleryNavigation from '@components/GalleryNavigation.astro';
import GalleryKeyboardHints from '@components/GalleryKeyboardHints.astro';
import type { CollectionEntry } from 'astro:content';
import type { ArtworkEntry } from '../../../types/artwork';
import { generateSEOTags, type SEOConfig } from "@utils/seo";
import { getNextSeries } from '../../../config/series-order';

const CURRENT_SERIES_SLUG = 'commissions';
const CURRENT_SERIES_NAME = 'Public Commissions';

const allEntries: CollectionEntry<'artwork'>[] = await getCollection("artwork");
const artworks: ArtworkEntry[] = allEntries.filter(
  (entry) => entry.data.series === CURRENT_SERIES_NAME
);

const seoConfig: SEOConfig = {
  title: "Public Commissions",
  description: "Panoramic photo collages created for public art commissions",
  keywords: [],
  type: "article" as const,
  image: artworks[0]?.data.cloudinaryId
};

const seoTags = generateSEOTags(seoConfig);
---

<GalleryScrollLayout
  title="Public Commissions"
  description="Panoramic photo collages created for public art commissions"
  artworkCount={artworks.length}
  seoTags={seoTags}
>
  <GalleryKeyboardHints />

  {artworks.map((artwork, index) => (
    <ArtworkCard
      artwork={artwork}
      index={index}
      total={artworks.length}
      seriesName={CURRENT_SERIES_NAME}
      isFirst={index === 0}
    />
  ))}
  <!-- Gallery Navigation - Next/Previous Series -->
  <GalleryNavigation currentSeries="Public Commissions" />
</GalleryScrollLayout>

<script>
  // Infinite scroll: Load next series when approaching bottom
  import { initInfiniteScroll } from '../../../scripts/gallery-infinite-scroll';

  initInfiniteScroll('commissions');
</script>
